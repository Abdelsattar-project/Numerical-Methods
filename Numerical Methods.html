<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8"/>
        <title>Math IV solver</title>
        <style>
            #Bisection {
                text-align: center;
            }
        </style>
        <script>

            function isOperand(c){
                return (c == '^' || c == '*' || c == '/' || c == '+' || c == '-');
            }

            function getBeforeIDX(s, st){
                let i;
                for(i = st-1; i >= 0 && !isOperand(s[i]); i--)
                    continue;
                if(s[i] == '-')
                    return i;
                return i+1;
            }

            function getAfterIDX(s, st){
                let i;
                for(i = st+1; i < s.length; i++) {
                    if(i > st+1 && isOperand(s[i]))
                        break;
                }
                return i-1;
            }

            function fixString(s){
                while (s.includes(" "))
                    s = s.replace(" ", "");

                for(let i = 'A', j = 'a'; i <= 'Z'; i++, j++)
                    while (s.includes(i))
                        s = s.replace(i, j);

                while (s.includes("sin"))
                    s = s.replace("sin", "s");
                while (s.includes("cos"))
                    s = s.replace("cos", "c");
                while (s.includes("tan"))
                    s = s.replace("tan", "t");
                while (s.includes("sec"))
                    s = s.replace("sec", "S");

                return s;
            }

            function calc(s){
                s = fixString(s);

                // 1st priority ()
                while (s.includes('(')){
                    let start;
                    let end;
                    for(let i = 0; i < s.length; i++){
                        if(s[i] == '(')
                            start = i;
                        else if(s[i] == ')') {
                            end = i;
                            break;
                        }
                    }
                    let replaced = s.slice(start, end+1);
                    let New = s.slice(start+1, end);
                    s = s.replace(replaced, calc(New));
                }

                while (s.includes('^')){
                    let start = s.indexOf('^');
                    let beforeIDX = getBeforeIDX(s,start);
                    let afterIDX = getAfterIDX(s,start);
                    let power = Math.pow(s.slice(beforeIDX, start), s.slice(start+1, afterIDX+1));
                    s = s.replace(s.slice(beforeIDX, afterIDX+1), power);
                }

                // 2nd priority sin cos tan
                while (s.includes('s') || s.includes('c') || s.includes('t') || s.includes('S')){
                    let start;
                    for(let i = 0; i < s.length; i++){
                        if(s[i] == 's' || s[i] == 'c' || s[i] == 't'){
                            start = i;
                            break;
                        }
                    }
                    let afterIDX = getAfterIDX(s,start);
                    let after = s.slice(start+1, afterIDX+1);
                    let res;
                    if(s[start] == 's')
                        res = Math.sin(after);
                    else if(s[start] == 'c')
                        res = Math.cos(after);
                    else if(s[start] == 't')
                        res = Math.tan(after);
                    // sec
                    else if(s[start] == 'S')
                        res = 1/Math.tan(after);
                     s = s.replace(s.slice(start, afterIDX+1), res);
                }

                // 4th priority */
                while (s.includes('*') || s.includes('/')){
                    let start;
                    for(let i = 0; i < s.length; i++){
                        if(s[i] == '*' || s[i] == '/'){
                            start = i;
                            break;
                        }
                    }
                    let beforeIDX = getBeforeIDX(s,start);
                    let afterIDX = getAfterIDX(s,start);
                    let res;
                    if(s[start] == '*')
                        res = s.slice(beforeIDX, start) * s.slice(start+1, afterIDX+1);
                    else if(s[start] == '/')
                        res = s.slice(beforeIDX, start) / s.slice(start+1, afterIDX+1);
                    s = s.replace(s.slice(beforeIDX, afterIDX+1), res);
                }

                // 5th priority +-
                while (s.includes('+') || s.indexOf('-') > 0){
                    let start;
                    for(let i = 1; i < s.length; i++){
                        if(s[i] == '+' || s[i] == '-'){
                            start = i;
                            break;
                        }
                    }
                    let beforeIDX = getBeforeIDX(s,start);
                    let afterIDX = getAfterIDX(s,start);
                    let sum;
                    if(s[start] == '+')
                        sum = +s.slice(beforeIDX, start) + +s.slice(start+1, afterIDX+1);
                    else
                        sum = s.slice(beforeIDX, start) - s.slice(start+1, afterIDX+1);
                    s = s.replace(s.slice(beforeIDX, afterIDX+1), sum);
                }
                return s;
            }

        </script> 
        
    </head>
    
    <body>
        <div id="Bisection">
            <h2>Bisection</h2>
            <label>Enter equation:</label><br>
            <input type="text" id="equation"> = 0<br>
            <input type="button" onclick="document.getElementById('equation').value = calc(document.getElementById('equation').value);"><br>
        </div>
    </body>
</html>